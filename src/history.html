<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <link rel="stylesheet" href="history.css">

    <!----===== Boxicons CSS ===== -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <!----===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <title>History</title>
</head>

<body>
    <div class="container">
        <div class="container-sidebar">
            <nav class="sidebar close">
                <header>
                    <div class="image-text">
                        <span class="image">
                            <img src="logo_cs266.png" alt="">
                        </span>
                        <div class="text logo-text">
                            <span class="name">Expense Tracker</span>
                            <span class="profession">CS266</span>
                        </div>
                    </div>
                    <i class='bx bx-chevron-right toggle'></i>
                </header>

                <div class="menu-bar">
                    <div class="menu">
                        <ul class="menu-links">
                                <a href="/">
                                    <i class='bx bx-home-alt icon'></i>
                                    <span class="text nav-text">HOME</span>
                                </a>
                            </li>
                            
                            <li class="nav-link">
                                <a href="tag">
                                    <i class='bx bx-tag icon'></i>
                                    <span class="text nav-text">TAG</span>
                                </a>
                            </li>

                            <li class="nav-link">
                                <a href="history">
                                    <i class='bx bx-history icon'></i>
                                    <span class="text nav-text">HISTORY</span>
                                </a>
                            </li>

                            
                        </ul>
                    </div>

                    <div class="bottom-content">
                        <!-- <li class="">
                            <a href="#">
                                <i class='bx bx-log-out icon' ></i>
                                <span class="text nav-text">Logout</span>
                            </a>
                        </li> -->
                        <li class="mode">
                            <div class="sun-moon">
                                <i class='bx bx-moon icon moon'></i>
                                <i class='bx bx-sun icon sun'></i>
                            </div>
                            <span class="mode-text text">Dark mode</span>
                            <div class="toggle-switch">
                                <span class="switch"></span>
                            </div>
                        </li>

                    </div>
                </div>
            </nav>

            <section class="home">




                <div class="center" style="display: flex;justify-content: space-between;">
                    <div class="container-home">
                        <div class="text">History</div>
                        <div class="title">
                            <div class="monthTitle">
                                <select name="month" id="month">
                                </select>
                                <!-- Drop down tags goes here -->
                            </div>
                            
                        </div>
                        <div id="activity">
                            <!-- ACTIVITY -->

                         <div class="activity">  

                        </div>
                    </div>

                    </div>

                    

                        <script>
                            // Function to get the month name
                            function getMonthName(monthIndex) {
                                const months = [
                                    "January", "February", "March", "April", "May", "June",
                                    "July", "August", "September", "October", "November", "December"
                                ];
                                return months[monthIndex];
                            }
                    
                            // Function to populate the select element with months
                            function populateMonths() {
                                const monthSelect = document.getElementById("month");
                    
                                // Get the current date
                                const currentDate = new Date();
                                let temp = currentDate.getMonth();
                    
                                // Loop to add the last 12 months to the select options
                                for (let i = 0; i < 12; i++) {
                                    const monthIndex = (currentDate.getMonth() - i + 12) % 12;
                                    let year = currentDate.getFullYear();

                                    if(currentDate.getMonth() < monthIndex){
                                        year = currentDate.getFullYear()-1;
                                    }
                    
                                    const optionText = getMonthName(monthIndex) + ' ' + year;
                                    const optionValue = `${year}-${(monthIndex + 1).toString().padStart(2, '0')}`;
                    
                                    // Create and append the option element
                                    const option = document.createElement("option");
                                    option.value = optionValue;
                                    option.text = optionText;
                    
                                    monthSelect.add(option);
                                }
                            }
                    
                            // Call the function to populate the select elements
                            populateMonths();

                            document.getElementById("month").addEventListener("change", function () {
                                const month = document.getElementById("month").value;
                                const tag = document.getElementById("tags").value;
                                console.log(this.value);
                                // Fetch /history with the selected date as a query parameter
                                fetch(`/historyData?month=${month}&&tag=${tag}`)
                                    .then(response => response.text())
                                    .then(html => {
                                    // Update the content of the history container
                                    document.getElementById('activity').innerHTML = html;
                                    })
                                    .catch(error => console.error('Error fetching /history:', error));
                            });
                            document.getElementById("tags").addEventListener("change", function () {
                                console.log(this.value);
                            });

                            document.getElementById("tags").addEventListener("change", function () {
                                const month = document.getElementById("month").value;
                                const tag = document.getElementById("tags").value;
                                console.log(this.value);
                                // Fetch /history with the selected date as a query parameter
                                fetch(`/historyData?month=${month}&&tag=${tag}`)
                                    .then(response => response.text())
                                    .then(html => {
                                    // Update the content of the history container
                                    document.getElementById('activity').innerHTML = html;
                                    })
                                    .catch(error => console.error('Error fetching /history:', error));
                            });
                            document.getElementById("tags").addEventListener("change", function () {
                                console.log(this.value);
                            });
                        </script>
                    


                </div>
        </div>
        </section>



        <script>
            const body = document.querySelector('body'),
                sidebar = body.querySelector('nav'),
                toggle = body.querySelector(".toggle"),
                modeSwitch = body.querySelector(".toggle-switch"),
                modeText = body.querySelector(".mode-text");

            toggle.addEventListener("click", () => {
                sidebar.classList.toggle("close");
            })
            modeSwitch.addEventListener("click", () => {
                body.classList.toggle("dark");

                if (body.classList.contains("dark")) {
                    modeText.innerText = "Light mode";
                } else {
                    modeText.innerText = "Dark mode";

                }
            });
        </script>
    </div>



    </div>

</body>

</html>